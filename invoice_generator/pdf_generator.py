from datetime import datetime, timedelta

from pdfme import build_pdf
from invoice_generator import timesheet_json
from invoice_generator import invoice_data_generator
import copy


# docs: https://pdfme.readthedocs.io/en/latest/examples.html

def create_timesheet(employee_name, company, timesheet_data, rate):
    with open('invoice_generator/invoice_number.txt', 'r') as f:
        invoice_number = int(f.read())
    timesheet_rows = []
    total_worked_seconds = sum([x['worked_seconds'] for x in timesheet_data['data']])
    t = timedelta(seconds=total_worked_seconds)
    total_hours = f'{t.days * 24 + t.seconds // 3600:02}:{(t.seconds % 3600) // 60:02}'
    total_pay = rate * (total_worked_seconds / 60 / 60)

    for entry in timesheet_data['data']:
        date = entry["Date"]
        day = entry["Day"]
        time_in = entry["Time In"]
        break_start = entry["Break Start"]
        break_end = entry["Break End"]
        time_out = entry["Time Out"]
        hours = entry["Total Hours"]

        timesheet_rows.append([
            {"colspan": 1, ".": [date]},
            {"colspan": 1, ".": [day]},
            {"colspan": 1, ".": [time_in]},
            {"colspan": 1, ".": [break_start]},
            {"colspan": 1, ".": [break_end]},
            {"colspan": 1, ".": [time_out]},
            {"colspan": 1, ".": [hours]},
        ])

    document = {
        "style": {
            "margin_bottom": 15,
            "page_size": "letter", "margin": [60, 50],
        },
        "sections": [
            {
                "style": {"page_numbering_style": "roman"},
                "content": [
                    {
                        "widths": [1],
                        "style": {"s": 15, "border_color": "white", "cell_fill": [0.6078, 0.7608, 0.9020], "cell_margin_bottom": 8, "text_align": "c", },
                        "table": [
                            [
                                {"colspan": 1, ".": ["Weekly Timesheet"], },
                            ],
                        ]
                    },
                    [{".b": employee_name, "style": {"s": 15, }}, ],
                    {
                        "widths": [1, 1, 1, 4],
                        "style": {"s": 9, "border_width": 0},
                        "table": [
                            [
                                {"colspan": 1, ".": [""]},
                                {"colspan": 1, ".b": ["For:"], "style": {"text_align": "r"}},
                                {"colspan": 1, ".": company},
                                {"colspan": 1, ".": [""]},
                            ],
                            [
                                {"colspan": 1, ".": [""]},
                                {"colspan": 1, ".b": ["Invoice:"], "style": {"text_align": "r"}},
                                {"colspan": 1, ".": [invoice_number]},
                                {"colspan": 1, ".": [""]},
                            ],
                        ]
                    },
                    {
                        "widths": [1, 1, 1, 1, 1, 1, 1],
                        "style": {"s": 9, "cell_margin_bottom": 8, "text_align": "c", },
                        "table": [
                            [
                                {"colspan": 1, ".": [{".b": "Date"}]},
                                {"colspan": 1, ".": [{".b": "Day"}]},
                                {"colspan": 1, ".": [{".b": "Time In"}]},
                                {"colspan": 1, ".": [{".b": "Time Out"}]},
                                {"colspan": 1, ".": [{".b": "Time In"}]},
                                {"colspan": 1, ".": [{".b": "Time Out"}]},
                                {"colspan": 1, ".": [{".b": "Total Hours"}]},
                            ],
                            *timesheet_rows,
                        ]
                    },
                    {
                        "widths": [4, 2, 1],
                        "style": {"s": 12, "border_color": "white"},
                        "table": [
                            [
                                {"colspan": 1, ".": [""]},
                                {"colspan": 1, ".b": ["Total Hours"], "style": {"text_align": "r"}},
                                {"colspan": 1, ".": [total_hours], "style": {"text_align": "c", "cell_fill": [0.6078, 0.7608, 0.9020]}},
                            ],
                            [
                                {"colspan": 1, ".": [""]},
                                {"colspan": 1, ".b": ["Rate"], "style": {"text_align": "r"}},
                                {"colspan": 1, ".": [f"${rate}"], "style": {"text_align": "c", "cell_fill": [0.6078, 0.7608, 0.9020]}},
                            ],
                            [
                                {"colspan": 1, ".": [""]},
                                {"colspan": 1, ".b": ["Total Pay"], "style": {"text_align": "r"}},
                                {"colspan": 1, ".": [f"${total_pay}"], "style": {"text_align": "c", "cell_fill": [0.6078, 0.7608, 0.9020]}},
                            ],
                        ]
                    },
                ]
            },
        ]

    }

    invoice_path = f"invoice_generator/invoices/{datetime.now().strftime('%Y-%m-%d')} Invoice {company}.pdf"

    with open(invoice_path, "wb") as f:
        build_pdf(document, f)

    with open('invoice_generator/invoice_number.txt', 'w') as f:
        f.write(str(invoice_number + 1))

    return invoice_path


def process_data(data, days):
    for entry in data['data']:
        day = entry['Day']
        if day not in days:
            entry['Time In'] = ""
            entry['Break Start'] = ""
            entry['Break End'] = ""
            entry['Time Out'] = ""
            entry['Total Hours'] = "00:00"
            entry['worked_seconds'] = 0
    return data


def main(canvas_days, cyrus_days):
    # Example usage:
    timesheet_data = timesheet_json.using_selenium()
    # timesheet_data = '[{"Id":8303,"Employee":23,"EmployeeHistory":2723,"EmployeeAgreement":49,"Date":"2024-04-26T00:00:00+10:00","StartTime":1714085700,"EndTime":1714114860,"Mealbreak":"2024-04-26T00:30:00+10:00","MealbreakSlots":"","Slots":[{"blnEmptySlot":false,"strType":"B","intStart":3900,"intEnd":5700,"intUnixStart":1714089600,"intUnixEnd":1714091400,"mixedActivity":{"intState":4,"blnCanStartEarly":0,"blnCanEndEarly":0,"blnIsMandatory":0,"strBreakType":"M"},"strTypeName":"Meal Break","strState":"Finished Duration"}],"TotalTime":7.6,"TotalTimeInv":7.6,"Cost":0,"Roster":null,"EmployeeComment":"","SupervisorComment":null,"Supervisor":null,"Disputed":false,"TimeApproved":false,"TimeApprover":null,"Discarded":null,"ValidationFlag":0,"OperationalUnit":7,"IsInProgress":false,"IsLeave":false,"LeaveId":null,"LeaveRule":null,"Invoiced":false,"InvoiceComment":null,"PayRuleApproved":false,"Exported":null,"StagingId":null,"PayStaged":false,"PaycycleId":2379,"MarkedPaidUnpaidAt":"","AccrualState":null,"AccrualStateChangedAt":null,"AccrualAttempts":null,"File":null,"CustomFieldData":null,"RealTime":false,"AutoProcessed":false,"AutoRounded":false,"AutoTimeApproved":false,"AutoPayRuleApproved":false,"Metadata":"{\\"borrowed_or_lent\\":false,\\"forecast_cost\\":0}","ParentId":null,"Creator":23,"Created":"2024-04-30T11:18:55+10:00","Modified":"2024-04-30T11:18:56+10:00","OperationalUnitObject":{"Id":7,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Company":3,"WorkType":null,"ParentOperationalUnit":0,"OperationalUnitName":"Beaconsfield","Active":true,"PayrollExportName":"","Address":159,"Contact":null,"RosterSortOrder":0,"ShowOnRoster":true,"Colour":null,"RosterActiveHoursSchedule":null,"DailyRosterBudget":null,"OperationalUnitType":null,"AddressObject":{"Id":159,"ContactName":null,"UnitNo":null,"StreetNo":null,"SuiteNo":null,"PoBox":null,"Street1":"Beaconsfield ","Street2":null,"City":null,"State":null,"Postcode":null,"Country":13,"Phone":null,"Notes":null,"Format":null,"Saved":null,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Print":"Beaconsfield \\n"},"CompanyCode":"Stu","CompanyName":"Alexandria","CompanyAddress":159},"StartTimeLocalized":"2024-04-26T08:55:00+10:00","EndTimeLocalized":"2024-04-26T17:01:00+10:00","OnCost":0,"ExternalId":null,"_DPMetaData":{"System":"Timesheet","CreatorInfo":{"Id":23,"DisplayName":"Shashwat Canvas","EmployeeProfile":23,"Employee":23,"Photo":"https:\\/\\/d11hmzhsuwuq9f.cloudfront.net\\/my\\/avatar?name=S+C&width=135&height=135","Pronouns":0,"CustomPronouns":null},"OperationalUnitInfo":{"Id":7,"OperationalUnitName":"Beaconsfield","Company":3,"CompanyName":"Alexandria","LabelWithCompany":"[Stu] Beaconsfield"},"EmployeeInfo":{"Id":23,"DisplayName":"Shashwat Canvas","EmployeeProfile":23,"Employee":23,"Photo":"https:\\/\\/d11hmzhsuwuq9f.cloudfront.net\\/my\\/avatar?name=S+C&width=135&height=135","Pronouns":0,"CustomPronouns":null},"CustomFieldData":null}},{"Id":8298,"Employee":23,"EmployeeHistory":2723,"EmployeeAgreement":49,"Date":"2024-04-29T00:00:00+10:00","StartTime":1714345920,"EndTime":1714374540,"Mealbreak":"2024-04-29T00:30:00+10:00","MealbreakSlots":"","Slots":[{"blnEmptySlot":false,"strType":"B","intStart":-720,"intEnd":1080,"intUnixStart":1714345200,"intUnixEnd":1714347000,"mixedActivity":{"intState":4,"blnCanStartEarly":1,"blnCanEndEarly":1,"blnIsMandatory":1,"strBreakType":"M"},"strTypeName":"Meal Break","strState":"Finished Duration"}],"TotalTime":7.45,"TotalTimeInv":7.8,"Cost":0,"Roster":11490,"EmployeeComment":null,"SupervisorComment":null,"Supervisor":null,"Disputed":false,"TimeApproved":false,"TimeApprover":null,"Discarded":null,"ValidationFlag":0,"OperationalUnit":7,"IsInProgress":false,"IsLeave":false,"LeaveId":null,"LeaveRule":null,"Invoiced":false,"InvoiceComment":null,"PayRuleApproved":false,"Exported":null,"StagingId":null,"PayStaged":false,"PaycycleId":2383,"MarkedPaidUnpaidAt":"","AccrualState":null,"AccrualStateChangedAt":null,"AccrualAttempts":null,"File":null,"CustomFieldData":null,"RealTime":true,"AutoProcessed":true,"AutoRounded":false,"AutoTimeApproved":false,"AutoPayRuleApproved":false,"Metadata":"{\\"borrowed_or_lent\\":false,\\"forecast_cost\\":0}","ParentId":null,"Creator":23,"Created":"2024-04-29T09:12:02+10:00","Modified":"2024-04-30T00:11:46+10:00","RosterObject":{"Id":11490,"Date":"2024-04-29T00:00:00+10:00","StartTime":1714345200,"EndTime":1714374000,"Mealbreak":"2024-05-03T00:30:00+10:00","Slots":[{"blnEmptySlot":false,"strType":"B","intStart":0,"intEnd":1800,"intUnixStart":1714345200,"intUnixEnd":1714347000,"mixedActivity":{"intState":3,"blnCanStartEarly":1,"blnCanEndEarly":1,"blnIsMandatory":1,"strBreakType":"M"},"strTypeName":"Meal Break","strState":"Scheduled Duration"}],"TotalTime":7.5,"Cost":0,"OperationalUnit":7,"Employee":23,"Comment":"","Warning":"","WarningOverrideComment":"","Published":true,"MatchedByTimesheet":8298,"CustomFieldData":null,"Open":false,"ApprovalRequired":false,"ConfirmStatus":0,"ConfirmComment":"","ConfirmBy":0,"ConfirmTime":0,"SwapStatus":0,"SwapManageBy":null,"ShiftTemplate":1,"ConnectStatus":null,"ParentId":null,"Creator":1,"Created":"2024-04-27T10:13:35+10:00","Modified":"2024-04-29T09:12:02+10:00","OperationalUnitObject":{"Id":7,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Company":3,"WorkType":null,"ParentOperationalUnit":0,"OperationalUnitName":"Beaconsfield","Active":true,"PayrollExportName":"","Address":159,"Contact":null,"RosterSortOrder":0,"ShowOnRoster":true,"Colour":null,"RosterActiveHoursSchedule":null,"DailyRosterBudget":null,"OperationalUnitType":null,"AddressObject":{"Id":159,"ContactName":null,"UnitNo":null,"StreetNo":null,"SuiteNo":null,"PoBox":null,"Street1":"Beaconsfield ","Street2":null,"City":null,"State":null,"Postcode":null,"Country":13,"Phone":null,"Notes":null,"Format":null,"Saved":null,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Print":"Beaconsfield \\n"},"CompanyCode":"Stu","CompanyName":"Alexandria","CompanyAddress":159},"OnCost":0,"StartTimeLocalized":"2024-04-29T09:00:00+10:00","EndTimeLocalized":"2024-04-29T17:00:00+10:00","ExternalId":null,"ConnectCreator":null},"OperationalUnitObject":{"Id":7,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Company":3,"WorkType":null,"ParentOperationalUnit":0,"OperationalUnitName":"Beaconsfield","Active":true,"PayrollExportName":"","Address":159,"Contact":null,"RosterSortOrder":0,"ShowOnRoster":true,"Colour":null,"RosterActiveHoursSchedule":null,"DailyRosterBudget":null,"OperationalUnitType":null,"AddressObject":{"Id":159,"ContactName":null,"UnitNo":null,"StreetNo":null,"SuiteNo":null,"PoBox":null,"Street1":"Beaconsfield ","Street2":null,"City":null,"State":null,"Postcode":null,"Country":13,"Phone":null,"Notes":null,"Format":null,"Saved":null,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Print":"Beaconsfield \\n"},"CompanyCode":"Stu","CompanyName":"Alexandria","CompanyAddress":159},"StartTimeLocalized":"2024-04-29T09:12:00+10:00","EndTimeLocalized":"2024-04-29T17:09:00+10:00","OnCost":0,"ExternalId":null,"_DPMetaData":{"System":"Timesheet","CreatorInfo":{"Id":23,"DisplayName":"Shashwat Canvas","EmployeeProfile":23,"Employee":23,"Photo":"https:\\/\\/d11hmzhsuwuq9f.cloudfront.net\\/my\\/avatar?name=S+C&width=135&height=135","Pronouns":0,"CustomPronouns":null},"OperationalUnitInfo":{"Id":7,"OperationalUnitName":"Beaconsfield","Company":3,"CompanyName":"Alexandria","LabelWithCompany":"[Stu] Beaconsfield"},"EmployeeInfo":{"Id":23,"DisplayName":"Shashwat Canvas","EmployeeProfile":23,"Employee":23,"Photo":"https:\\/\\/d11hmzhsuwuq9f.cloudfront.net\\/my\\/avatar?name=S+C&width=135&height=135","Pronouns":0,"CustomPronouns":null},"CustomFieldData":null}},{"Id":8302,"Employee":23,"EmployeeHistory":2723,"EmployeeAgreement":49,"Date":"2024-04-30T00:00:00+10:00","StartTime":1714432620,"EndTime":1714461600,"Mealbreak":"2024-04-30T00:30:00+10:00","MealbreakSlots":"","Slots":[{"blnEmptySlot":false,"strType":"B","intStart":2580,"intEnd":4380,"intUnixStart":1714435200,"intUnixEnd":1714437000,"mixedActivity":{"intState":4,"blnCanStartEarly":1,"blnCanEndEarly":1,"blnIsMandatory":1,"strBreakType":"M"},"strTypeName":"Meal Break","strState":"Finished Duration"}],"TotalTime":7.55,"TotalTimeInv":7.72,"Cost":0,"Roster":11472,"EmployeeComment":null,"SupervisorComment":null,"Supervisor":null,"Disputed":false,"TimeApproved":false,"TimeApprover":null,"Discarded":null,"ValidationFlag":0,"OperationalUnit":7,"IsInProgress":false,"IsLeave":false,"LeaveId":null,"LeaveRule":null,"Invoiced":false,"InvoiceComment":null,"PayRuleApproved":false,"Exported":null,"StagingId":null,"PayStaged":false,"PaycycleId":2383,"MarkedPaidUnpaidAt":"","AccrualState":null,"AccrualStateChangedAt":null,"AccrualAttempts":null,"File":null,"CustomFieldData":null,"RealTime":true,"AutoProcessed":true,"AutoRounded":false,"AutoTimeApproved":false,"AutoPayRuleApproved":false,"Metadata":"{\\"borrowed_or_lent\\":false,\\"forecast_cost\\":0}","ParentId":null,"Creator":23,"Created":"2024-04-30T09:17:41+10:00","Modified":"2024-05-01T00:12:18+10:00","RosterObject":{"Id":11472,"Date":"2024-04-30T00:00:00+10:00","StartTime":1714431600,"EndTime":1714460400,"Mealbreak":"2024-05-03T00:30:00+10:00","Slots":[{"blnEmptySlot":false,"strType":"B","intStart":3600,"intEnd":5400,"intUnixStart":1714435200,"intUnixEnd":1714437000,"mixedActivity":{"intState":3,"blnCanStartEarly":0,"blnCanEndEarly":0,"blnIsMandatory":0,"strBreakType":"M"},"strTypeName":"Meal Break","strState":"Scheduled Duration"}],"TotalTime":7.5,"Cost":0,"OperationalUnit":7,"Employee":23,"Comment":"","Warning":"","WarningOverrideComment":"","Published":true,"MatchedByTimesheet":8302,"CustomFieldData":null,"Open":false,"ApprovalRequired":false,"ConfirmStatus":0,"ConfirmComment":"","ConfirmBy":0,"ConfirmTime":0,"SwapStatus":0,"SwapManageBy":null,"ShiftTemplate":null,"ConnectStatus":null,"ParentId":null,"Creator":1,"Created":"2024-04-27T10:13:35+10:00","Modified":"2024-04-30T09:17:41+10:00","OperationalUnitObject":{"Id":7,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Company":3,"WorkType":null,"ParentOperationalUnit":0,"OperationalUnitName":"Beaconsfield","Active":true,"PayrollExportName":"","Address":159,"Contact":null,"RosterSortOrder":0,"ShowOnRoster":true,"Colour":null,"RosterActiveHoursSchedule":null,"DailyRosterBudget":null,"OperationalUnitType":null,"AddressObject":{"Id":159,"ContactName":null,"UnitNo":null,"StreetNo":null,"SuiteNo":null,"PoBox":null,"Street1":"Beaconsfield ","Street2":null,"City":null,"State":null,"Postcode":null,"Country":13,"Phone":null,"Notes":null,"Format":null,"Saved":null,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Print":"Beaconsfield \\n"},"CompanyCode":"Stu","CompanyName":"Alexandria","CompanyAddress":159},"OnCost":0,"StartTimeLocalized":"2024-04-30T09:00:00+10:00","EndTimeLocalized":"2024-04-30T17:00:00+10:00","ExternalId":null,"ConnectCreator":null},"OperationalUnitObject":{"Id":7,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Company":3,"WorkType":null,"ParentOperationalUnit":0,"OperationalUnitName":"Beaconsfield","Active":true,"PayrollExportName":"","Address":159,"Contact":null,"RosterSortOrder":0,"ShowOnRoster":true,"Colour":null,"RosterActiveHoursSchedule":null,"DailyRosterBudget":null,"OperationalUnitType":null,"AddressObject":{"Id":159,"ContactName":null,"UnitNo":null,"StreetNo":null,"SuiteNo":null,"PoBox":null,"Street1":"Beaconsfield ","Street2":null,"City":null,"State":null,"Postcode":null,"Country":13,"Phone":null,"Notes":null,"Format":null,"Saved":null,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Print":"Beaconsfield \\n"},"CompanyCode":"Stu","CompanyName":"Alexandria","CompanyAddress":159},"StartTimeLocalized":"2024-04-30T09:17:00+10:00","EndTimeLocalized":"2024-04-30T17:20:00+10:00","OnCost":0,"ExternalId":null,"_DPMetaData":{"System":"Timesheet","CreatorInfo":{"Id":23,"DisplayName":"Shashwat Canvas","EmployeeProfile":23,"Employee":23,"Photo":"https:\\/\\/d11hmzhsuwuq9f.cloudfront.net\\/my\\/avatar?name=S+C&width=135&height=135","Pronouns":0,"CustomPronouns":null},"OperationalUnitInfo":{"Id":7,"OperationalUnitName":"Beaconsfield","Company":3,"CompanyName":"Alexandria","LabelWithCompany":"[Stu] Beaconsfield"},"EmployeeInfo":{"Id":23,"DisplayName":"Shashwat Canvas","EmployeeProfile":23,"Employee":23,"Photo":"https:\\/\\/d11hmzhsuwuq9f.cloudfront.net\\/my\\/avatar?name=S+C&width=135&height=135","Pronouns":0,"CustomPronouns":null},"CustomFieldData":null}},{"Id":8305,"Employee":23,"EmployeeHistory":2723,"EmployeeAgreement":49,"Date":"2024-05-01T00:00:00+10:00","StartTime":1714521420,"EndTime":1714543800,"Mealbreak":"2024-05-01T00:30:00+10:00","MealbreakSlots":"","Slots":[{"blnEmptySlot":false,"strType":"B","intStart":-3420,"intEnd":-1620,"intUnixStart":1714518000,"intUnixEnd":1714519800,"mixedActivity":{"intState":4,"blnCanStartEarly":1,"blnCanEndEarly":1,"blnIsMandatory":1,"strBreakType":"M"},"strTypeName":"Meal Break","strState":"Finished Duration"}],"TotalTime":5.72,"TotalTimeInv":7.05,"Cost":0,"Roster":11481,"EmployeeComment":null,"SupervisorComment":null,"Supervisor":null,"Disputed":false,"TimeApproved":false,"TimeApprover":null,"Discarded":null,"ValidationFlag":0,"OperationalUnit":7,"IsInProgress":false,"IsLeave":false,"LeaveId":null,"LeaveRule":null,"Invoiced":false,"InvoiceComment":null,"PayRuleApproved":false,"Exported":null,"StagingId":null,"PayStaged":false,"PaycycleId":2383,"MarkedPaidUnpaidAt":"","AccrualState":null,"AccrualStateChangedAt":null,"AccrualAttempts":null,"File":null,"CustomFieldData":null,"RealTime":true,"AutoProcessed":true,"AutoRounded":false,"AutoTimeApproved":false,"AutoPayRuleApproved":false,"Metadata":"{\\"borrowed_or_lent\\":false,\\"forecast_cost\\":0}","ParentId":null,"Creator":23,"Created":"2024-05-01T09:57:19+10:00","Modified":"2024-05-02T00:11:49+10:00","RosterObject":{"Id":11481,"Date":"2024-05-01T00:00:00+10:00","StartTime":1714518000,"EndTime":1714546800,"Mealbreak":"2024-05-03T00:30:00+10:00","Slots":[{"blnEmptySlot":false,"strType":"B","intStart":0,"intEnd":1800,"intUnixStart":1714518000,"intUnixEnd":1714519800,"mixedActivity":{"intState":3,"blnCanStartEarly":0,"blnCanEndEarly":0,"blnIsMandatory":1,"strBreakType":"M"},"strTypeName":"Meal Break","strState":"Scheduled Duration"}],"TotalTime":7.5,"Cost":0,"OperationalUnit":7,"Employee":23,"Comment":"","Warning":"","WarningOverrideComment":"","Published":true,"MatchedByTimesheet":8305,"CustomFieldData":null,"Open":false,"ApprovalRequired":false,"ConfirmStatus":0,"ConfirmComment":"","ConfirmBy":0,"ConfirmTime":0,"SwapStatus":0,"SwapManageBy":null,"ShiftTemplate":null,"ConnectStatus":null,"ParentId":null,"Creator":1,"Created":"2024-04-27T10:13:35+10:00","Modified":"2024-05-01T09:57:19+10:00","OperationalUnitObject":{"Id":7,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Company":3,"WorkType":null,"ParentOperationalUnit":0,"OperationalUnitName":"Beaconsfield","Active":true,"PayrollExportName":"","Address":159,"Contact":null,"RosterSortOrder":0,"ShowOnRoster":true,"Colour":null,"RosterActiveHoursSchedule":null,"DailyRosterBudget":null,"OperationalUnitType":null,"AddressObject":{"Id":159,"ContactName":null,"UnitNo":null,"StreetNo":null,"SuiteNo":null,"PoBox":null,"Street1":"Beaconsfield ","Street2":null,"City":null,"State":null,"Postcode":null,"Country":13,"Phone":null,"Notes":null,"Format":null,"Saved":null,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Print":"Beaconsfield \\n"},"CompanyCode":"Stu","CompanyName":"Alexandria","CompanyAddress":159},"OnCost":0,"StartTimeLocalized":"2024-05-01T09:00:00+10:00","EndTimeLocalized":"2024-05-01T17:00:00+10:00","ExternalId":null,"ConnectCreator":null},"OperationalUnitObject":{"Id":7,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Company":3,"WorkType":null,"ParentOperationalUnit":0,"OperationalUnitName":"Beaconsfield","Active":true,"PayrollExportName":"","Address":159,"Contact":null,"RosterSortOrder":0,"ShowOnRoster":true,"Colour":null,"RosterActiveHoursSchedule":null,"DailyRosterBudget":null,"OperationalUnitType":null,"AddressObject":{"Id":159,"ContactName":null,"UnitNo":null,"StreetNo":null,"SuiteNo":null,"PoBox":null,"Street1":"Beaconsfield ","Street2":null,"City":null,"State":null,"Postcode":null,"Country":13,"Phone":null,"Notes":null,"Format":null,"Saved":null,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Print":"Beaconsfield \\n"},"CompanyCode":"Stu","CompanyName":"Alexandria","CompanyAddress":159},"StartTimeLocalized":"2024-05-01T09:57:00+10:00","EndTimeLocalized":"2024-05-01T16:10:00+10:00","OnCost":0,"ExternalId":null,"_DPMetaData":{"System":"Timesheet","CreatorInfo":{"Id":23,"DisplayName":"Shashwat Canvas","EmployeeProfile":23,"Employee":23,"Photo":"https:\\/\\/d11hmzhsuwuq9f.cloudfront.net\\/my\\/avatar?name=S+C&width=135&height=135","Pronouns":0,"CustomPronouns":null},"OperationalUnitInfo":{"Id":7,"OperationalUnitName":"Beaconsfield","Company":3,"CompanyName":"Alexandria","LabelWithCompany":"[Stu] Beaconsfield"},"EmployeeInfo":{"Id":23,"DisplayName":"Shashwat Canvas","EmployeeProfile":23,"Employee":23,"Photo":"https:\\/\\/d11hmzhsuwuq9f.cloudfront.net\\/my\\/avatar?name=S+C&width=135&height=135","Pronouns":0,"CustomPronouns":null},"CustomFieldData":null}},{"Id":8311,"Employee":23,"EmployeeHistory":2723,"EmployeeAgreement":49,"Date":"2024-05-02T00:00:00+10:00","StartTime":1714605180,"EndTime":1714634820,"Mealbreak":"2024-05-02T00:30:00+10:00","MealbreakSlots":"","Slots":[{"blnEmptySlot":false,"strType":"B","intStart":-780,"intEnd":1020,"intUnixStart":1714604400,"intUnixEnd":1714606200,"mixedActivity":{"intState":4,"blnCanStartEarly":1,"blnCanEndEarly":1,"blnIsMandatory":1,"strBreakType":"M"},"strTypeName":"Meal Break","strState":"Finished Duration"}],"TotalTime":7.73,"TotalTimeInv":7.78,"Cost":0,"Roster":11501,"EmployeeComment":null,"SupervisorComment":null,"Supervisor":null,"Disputed":false,"TimeApproved":false,"TimeApprover":null,"Discarded":null,"ValidationFlag":0,"OperationalUnit":7,"IsInProgress":false,"IsLeave":false,"LeaveId":null,"LeaveRule":null,"Invoiced":false,"InvoiceComment":null,"PayRuleApproved":false,"Exported":null,"StagingId":null,"PayStaged":false,"PaycycleId":2383,"MarkedPaidUnpaidAt":"","AccrualState":null,"AccrualStateChangedAt":null,"AccrualAttempts":null,"File":null,"CustomFieldData":null,"RealTime":true,"AutoProcessed":true,"AutoRounded":false,"AutoTimeApproved":false,"AutoPayRuleApproved":false,"Metadata":"{\\"borrowed_or_lent\\":false,\\"forecast_cost\\":0}","ParentId":null,"Creator":23,"Created":"2024-05-02T09:13:07+10:00","Modified":"2024-05-03T00:11:39+10:00","RosterObject":{"Id":11501,"Date":"2024-05-02T00:00:00+10:00","StartTime":1714604400,"EndTime":1714633200,"Mealbreak":"2024-05-03T00:30:00+10:00","Slots":[{"blnEmptySlot":false,"strType":"B","intStart":0,"intEnd":1800,"intUnixStart":1714604400,"intUnixEnd":1714606200,"mixedActivity":{"intState":3,"blnCanStartEarly":1,"blnCanEndEarly":1,"blnIsMandatory":1,"strBreakType":"M"},"strTypeName":"Meal Break","strState":"Scheduled Duration"}],"TotalTime":7.5,"Cost":0,"OperationalUnit":7,"Employee":23,"Comment":"","Warning":"","WarningOverrideComment":"","Published":true,"MatchedByTimesheet":8311,"CustomFieldData":null,"Open":false,"ApprovalRequired":false,"ConfirmStatus":0,"ConfirmComment":"","ConfirmBy":0,"ConfirmTime":0,"SwapStatus":0,"SwapManageBy":null,"ShiftTemplate":1,"ConnectStatus":null,"ParentId":null,"Creator":1,"Created":"2024-04-27T10:15:14+10:00","Modified":"2024-05-02T09:13:07+10:00","OperationalUnitObject":{"Id":7,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Company":3,"WorkType":null,"ParentOperationalUnit":0,"OperationalUnitName":"Beaconsfield","Active":true,"PayrollExportName":"","Address":159,"Contact":null,"RosterSortOrder":0,"ShowOnRoster":true,"Colour":null,"RosterActiveHoursSchedule":null,"DailyRosterBudget":null,"OperationalUnitType":null,"AddressObject":{"Id":159,"ContactName":null,"UnitNo":null,"StreetNo":null,"SuiteNo":null,"PoBox":null,"Street1":"Beaconsfield ","Street2":null,"City":null,"State":null,"Postcode":null,"Country":13,"Phone":null,"Notes":null,"Format":null,"Saved":null,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Print":"Beaconsfield \\n"},"CompanyCode":"Stu","CompanyName":"Alexandria","CompanyAddress":159},"OnCost":0,"StartTimeLocalized":"2024-05-02T09:00:00+10:00","EndTimeLocalized":"2024-05-02T17:00:00+10:00","ExternalId":null,"ConnectCreator":null},"OperationalUnitObject":{"Id":7,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Company":3,"WorkType":null,"ParentOperationalUnit":0,"OperationalUnitName":"Beaconsfield","Active":true,"PayrollExportName":"","Address":159,"Contact":null,"RosterSortOrder":0,"ShowOnRoster":true,"Colour":null,"RosterActiveHoursSchedule":null,"DailyRosterBudget":null,"OperationalUnitType":null,"AddressObject":{"Id":159,"ContactName":null,"UnitNo":null,"StreetNo":null,"SuiteNo":null,"PoBox":null,"Street1":"Beaconsfield ","Street2":null,"City":null,"State":null,"Postcode":null,"Country":13,"Phone":null,"Notes":null,"Format":null,"Saved":null,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Print":"Beaconsfield \\n"},"CompanyCode":"Stu","CompanyName":"Alexandria","CompanyAddress":159},"StartTimeLocalized":"2024-05-02T09:13:00+10:00","EndTimeLocalized":"2024-05-02T17:27:00+10:00","OnCost":0,"ExternalId":null,"_DPMetaData":{"System":"Timesheet","CreatorInfo":{"Id":23,"DisplayName":"Shashwat Canvas","EmployeeProfile":23,"Employee":23,"Photo":"https:\\/\\/d11hmzhsuwuq9f.cloudfront.net\\/my\\/avatar?name=S+C&width=135&height=135","Pronouns":0,"CustomPronouns":null},"OperationalUnitInfo":{"Id":7,"OperationalUnitName":"Beaconsfield","Company":3,"CompanyName":"Alexandria","LabelWithCompany":"[Stu] Beaconsfield"},"EmployeeInfo":{"Id":23,"DisplayName":"Shashwat Canvas","EmployeeProfile":23,"Employee":23,"Photo":"https:\\/\\/d11hmzhsuwuq9f.cloudfront.net\\/my\\/avatar?name=S+C&width=135&height=135","Pronouns":0,"CustomPronouns":null},"CustomFieldData":null}},{"Id":8313,"Employee":23,"EmployeeHistory":2723,"EmployeeAgreement":49,"Date":"2024-05-03T00:00:00+10:00","StartTime":1714692480,"EndTime":1714719600,"Mealbreak":"2024-05-03T00:00:00+10:00","MealbreakSlots":"","Slots":[{"blnEmptySlot":false,"strType":"B","intStart":-1680,"intEnd":120,"intUnixStart":1714690800,"intUnixEnd":1714692600,"mixedActivity":{"intState":3,"blnCanStartEarly":1,"blnCanEndEarly":1,"blnIsMandatory":1,"strBreakType":"M"},"strTypeName":"Meal Break","strState":"Scheduled Duration"}],"TotalTime":7.53,"TotalTimeInv":7.53,"Cost":0,"Roster":11484,"EmployeeComment":null,"SupervisorComment":null,"Supervisor":null,"Disputed":false,"TimeApproved":false,"TimeApprover":null,"Discarded":null,"ValidationFlag":0,"OperationalUnit":7,"IsInProgress":true,"IsLeave":false,"LeaveId":null,"LeaveRule":null,"Invoiced":false,"InvoiceComment":null,"PayRuleApproved":false,"Exported":null,"StagingId":null,"PayStaged":false,"PaycycleId":2383,"MarkedPaidUnpaidAt":"","AccrualState":null,"AccrualStateChangedAt":null,"AccrualAttempts":null,"File":null,"CustomFieldData":null,"RealTime":true,"AutoProcessed":false,"AutoRounded":false,"AutoTimeApproved":false,"AutoPayRuleApproved":false,"Metadata":"{\\"borrowed_or_lent\\":false,\\"forecast_cost\\":0}","ParentId":null,"Creator":23,"Created":"2024-05-03T09:28:58+10:00","Modified":"2024-05-03T09:29:00+10:00","RosterObject":{"Id":11484,"Date":"2024-05-03T00:00:00+10:00","StartTime":1714690800,"EndTime":1714719600,"Mealbreak":"2024-05-03T00:30:00+10:00","Slots":[{"blnEmptySlot":false,"strType":"B","intStart":0,"intEnd":1800,"intUnixStart":1714690800,"intUnixEnd":1714692600,"mixedActivity":{"intState":3,"blnCanStartEarly":1,"blnCanEndEarly":1,"blnIsMandatory":1,"strBreakType":"M"},"strTypeName":"Meal Break","strState":"Scheduled Duration"}],"TotalTime":7.5,"Cost":0,"OperationalUnit":7,"Employee":23,"Comment":"","Warning":"","WarningOverrideComment":"","Published":true,"MatchedByTimesheet":8313,"CustomFieldData":null,"Open":false,"ApprovalRequired":false,"ConfirmStatus":0,"ConfirmComment":"","ConfirmBy":0,"ConfirmTime":0,"SwapStatus":0,"SwapManageBy":null,"ShiftTemplate":1,"ConnectStatus":null,"ParentId":null,"Creator":1,"Created":"2024-04-27T10:13:35+10:00","Modified":"2024-05-03T09:28:59+10:00","OperationalUnitObject":{"Id":7,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Company":3,"WorkType":null,"ParentOperationalUnit":0,"OperationalUnitName":"Beaconsfield","Active":true,"PayrollExportName":"","Address":159,"Contact":null,"RosterSortOrder":0,"ShowOnRoster":true,"Colour":null,"RosterActiveHoursSchedule":null,"DailyRosterBudget":null,"OperationalUnitType":null,"AddressObject":{"Id":159,"ContactName":null,"UnitNo":null,"StreetNo":null,"SuiteNo":null,"PoBox":null,"Street1":"Beaconsfield ","Street2":null,"City":null,"State":null,"Postcode":null,"Country":13,"Phone":null,"Notes":null,"Format":null,"Saved":null,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Print":"Beaconsfield \\n"},"CompanyCode":"Stu","CompanyName":"Alexandria","CompanyAddress":159},"OnCost":0,"StartTimeLocalized":"2024-05-03T09:00:00+10:00","EndTimeLocalized":"2024-05-03T17:00:00+10:00","ExternalId":null,"ConnectCreator":null},"OperationalUnitObject":{"Id":7,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Company":3,"WorkType":null,"ParentOperationalUnit":0,"OperationalUnitName":"Beaconsfield","Active":true,"PayrollExportName":"","Address":159,"Contact":null,"RosterSortOrder":0,"ShowOnRoster":true,"Colour":null,"RosterActiveHoursSchedule":null,"DailyRosterBudget":null,"OperationalUnitType":null,"AddressObject":{"Id":159,"ContactName":null,"UnitNo":null,"StreetNo":null,"SuiteNo":null,"PoBox":null,"Street1":"Beaconsfield ","Street2":null,"City":null,"State":null,"Postcode":null,"Country":13,"Phone":null,"Notes":null,"Format":null,"Saved":null,"Creator":1,"Created":"2020-11-17T10:26:37+11:00","Modified":"2020-11-17T10:26:37+11:00","Print":"Beaconsfield \\n"},"CompanyCode":"Stu","CompanyName":"Alexandria","CompanyAddress":159},"StartTimeLocalized":"2024-05-03T09:28:00+10:00","EndTimeLocalized":"2024-05-03T17:00:00+10:00","OnCost":0,"ExternalId":null,"_DPMetaData":{"System":"Timesheet","CreatorInfo":{"Id":23,"DisplayName":"Shashwat Canvas","EmployeeProfile":23,"Employee":23,"Photo":"https:\\/\\/d11hmzhsuwuq9f.cloudfront.net\\/my\\/avatar?name=S+C&width=135&height=135","Pronouns":0,"CustomPronouns":null},"OperationalUnitInfo":{"Id":7,"OperationalUnitName":"Beaconsfield","Company":3,"CompanyName":"Alexandria","LabelWithCompany":"[Stu] Beaconsfield"},"EmployeeInfo":{"Id":23,"DisplayName":"Shashwat Canvas","EmployeeProfile":23,"Employee":23,"Photo":"https:\\/\\/d11hmzhsuwuq9f.cloudfront.net\\/my\\/avatar?name=S+C&width=135&height=135","Pronouns":0,"CustomPronouns":null},"CustomFieldData":null}}]'
    selection = {
        "schedule": {"Mon": "Canvas", "Tue": "Canvas", "Wed": "Cyrus", "Thu": "Canvas", "Fri": "Canvas"},
        "invoice_week": "This week" if datetime.now().isoweekday() > 4 else "Last week"
    }
    week_bool = 0 if selection['invoice_week'] == "This week" else 1
    required_dates = invoice_data_generator.get_week_dates(week_bool)
    table_data = invoice_data_generator.get_worked_data(timesheet_data, required_dates)

    # canvas_days = ['Monday', 'Tuesday', 'Thursday', 'Friday']
    # cyrus_days = ['Wednesday']

    canvas_data = process_data(copy.deepcopy(table_data), canvas_days)
    cyrus_data = process_data(copy.deepcopy(table_data), cyrus_days)
    rate = 30
    # invoice_number = 541

    canvas_invoice_path = create_timesheet("Shashwat Aryal", "Canvas", canvas_data, rate)
    cyrus_invoice_path = create_timesheet("Shashwat Aryal", "Cyrus", cyrus_data, rate)

    return [canvas_invoice_path, cyrus_invoice_path]


if __name__ == '__main__':
    canvas_days = ['Monday', 'Tuesday', 'Thursday', 'Friday']
    cyrus_days = ['Wednesday']
    main(canvas_days, cyrus_days)
